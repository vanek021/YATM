@using YATM.Components.Shared
@inherits LayoutComponentBase

@inject AuthenticationStateProvider authenticationStateProvider
@inject NavigationManager navManager

<PageTitle>YATM</PageTitle>

<Layout Class="app-layout">
    <header class="app-header">
        <div class="app-header__inner">
            <NavLink class="app-brand" href="" Match="NavLinkMatch.All" @onclick="CloseNavMenu">
                <span class="app-brand__logo" aria-hidden="true"></span>
                <span class="app-brand__label">
                    <span class="app-brand__title">YATM</span>
                    <span class="app-brand__subtitle">Yet Another Task Manager</span>
                </span>
            </NavLink>

            <div class="app-header__navigation">
                <nav class="app-nav @NavMenuCssClass" aria-label="Основное меню">
                    <NavLink class="app-nav__link" href="" Match="NavLinkMatch.All" @onclick="CloseNavMenu">
                        Доски
                    </NavLink>
                    <NavLink class="app-nav__link" href="notes" @onclick="CloseNavMenu">
                        Заметки
                    </NavLink>
                    <NavLink class="app-nav__link" href="health" @onclick="CloseNavMenu">
                        Здоровье
                    </NavLink>
                    <NavLink class="app-nav__link" href="habits" @onclick="CloseNavMenu">
                        Привычки
                    </NavLink>
                    <div class="app-nav__timer">
                        <SimpleTimer />
                    </div>
                </nav>

                <button type="button"
                        class="app-header__burger"
                        @onclick="ToggleNavMenu"
                        aria-label="Переключить меню"
                        aria-expanded="@(!_collapseNavMenu)">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </div>
    </header>

    @if (!_collapseNavMenu)
    {
        <button type="button" class="app-mobile-backdrop" @onclick="CloseNavMenu" aria-label="Закрыть меню"></button>
    }

    <Content Class="app-content">
        <div class="site-layout-content">
            @Body
        </div>
    </Content>
    <Footer Class="app-footer">YATM - Yet Another Task Manager - Еще один менеджер задач!</Footer>
</Layout>

@code {

    private bool _collapseNavMenu = true;

    private string NavMenuCssClass => _collapseNavMenu ? "app-nav--collapsed" : "app-nav--open";

    protected override async Task OnInitializedAsync()
    {
        var authState = await authenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity is null || !user.Identity.IsAuthenticated)
            navManager.NavigateTo("/Identity/Account/Login");
        await base.OnInitializedAsync();
    }

    private void ToggleNavMenu()
    {
        _collapseNavMenu = !_collapseNavMenu;
    }

    private void CloseNavMenu()
    {
        _collapseNavMenu = true;
    }
}